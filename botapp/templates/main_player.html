{% load static %}

{% block content %}
    <audio id="audioPlayer" src="{{ current_track.audio_file.url }}" preload="auto" class="w-100 mb-3"></audio>
    <canvas id="visualizer" width="100%" height="80"></canvas>
    <div class="controls d-flex justify-content-center my-3 flex-wrap gap-3">
        <button id="prevBtn" class="btn btn-outline-light btn-sm" aria-label="Previous">
            <!-- Ð˜ÐºÐ¾Ð½ÐºÐ° Previous -->
            <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"
                 stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                <polygon points="19 20 9 12 19 4 19 20"></polygon>
                <line x1="5" y1="19" x2="5" y2="5"></line>
            </svg>
        </button>
        <button id="playPauseBtn" class="btn btn-outline-light btn-sm" aria-label="Play/Pause">
            <!-- Ð˜ÐºÐ¾Ð½ÐºÐ° Play (Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ) -->
            <svg id="playIcon" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"
                 stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
            <!-- Ð˜ÐºÐ¾Ð½ÐºÐ° Pause (ÑÐºÑ€Ñ‹Ñ‚Ð° Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ) -->
            <svg id="pauseIcon" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"
                 stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" style="display:none;">
                <rect x="6" y="4" width="4" height="16"></rect>
                <rect x="14" y="4" width="4" height="16"></rect>
            </svg>
        </button>

        <button id="nextBtn" class="btn btn-outline-light btn-sm" aria-label="Next">
            <!-- Ð˜ÐºÐ¾Ð½ÐºÐ° Next -->
            <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"
                 stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                <polygon points="5 4 15 12 5 20 5 4"></polygon>
                <line x1="19" y1="5" x2="19" y2="19"></line>
            </svg>
        </button>

        <button id="loopBtn" class="btn btn-outline-light btn-sm" aria-label="Loop">
            <!-- Ð˜ÐºÐ¾Ð½ÐºÐ° Loop -->
            <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"
                 stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                <polyline points="17 1 21 5 17 9"></polyline>
                <path d="M3 11V9a4 4 0 0 1 4-4h14"></path>
                <polyline points="7 23 3 19 7 15"></polyline>
                <path d="M21 13v2a4 4 0 0 1-4 4H3"></path>
            </svg>
        </button>

        <button id="shuffleBtn" class="btn btn-outline-light btn-sm" aria-label="Shuffle">
            <!-- Ð˜ÐºÐ¾Ð½ÐºÐ° Shuffle -->
            <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"
                 stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                <polyline points="16 3 21 3 21 8"></polyline>
                <line x1="4" y1="20" x2="21" y2="3"></line>
                <polyline points="21 16 21 21 16 21"></polyline>
                <line x1="15" y1="15" x2="21" y2="21"></line>
                <line x1="4" y1="4" x2="9" y2="9"></line>
            </svg>
        </button>
    </div>

    <div class="progress-container d-flex align-items-center gap-2 mb-3">
        <span id="currentTime">0:00</span>

        <svg class="progress-svg flex-grow-1" viewBox="0 0 300 20" xmlns="http://www.w3.org/2000/svg"
             aria-hidden="true" role="img">
            <path class="progress-track" d="M10 10 Q 50 0, 90 10 T 170 10 T 270 10" stroke="#444"
                  stroke-width="6" fill="none"/>
            <path class="progress-bar" d="M10 10 Q 50 0, 90 10 T 170 10 T 270 10" stroke="#ffeb3b"
                  stroke-width="6" fill="none" stroke-linecap="round"/>
        </svg>

        <span id="duration">3:45</span>
    </div>

    <div class="volume-container d-flex align-items-center gap-2 mb-3">
        <svg class="volume-svg" viewBox="0 0 300 20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"
             role="img">
            <path class="volume-track" d="M10 10 Q 50 0, 90 10 T 170 10 T 270 10" stroke="#444" stroke-width="6"
                  fill="none"/>
            <path class="volume-bar" d="M10 10 Q 50 0, 90 10 T 170 10 T 270 10" stroke="#ede69d"
                  stroke-width="6" fill="none" stroke-linecap="round"/>
            <circle class="volume-thumb" cx="10" cy="10" r="10" fill="#ede69d"
                    filter="drop-shadow(0 0 6px #ede69d)"/>
        </svg>
        <span id="volumeIcon">ðŸ”Š</span>
    </div>

    <div class="track-list-wrapper position-relative bg-secondary bg-opacity-25 rounded p-2"
         style="overflow-x: auto; white-space: nowrap; -ms-overflow-style: none; scrollbar-width: none;">
        <!-- ÐŸÐ¾Ð´ÑÐºÐ°Ð·ÐºÐ° Ñ ÑÐ¼Ð¾Ð´Ð·Ð¸ / ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð¼ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÐºÑ€ÑƒÑ‚ÐºÐ¸ -->
        <div class="scroll-hint position-absolute"
             style="right: 10px; top: 70%; transform: translateY(-50%); pointer-events: none; user-select: none; font-size: 1.5rem; color: #555;">
            ðŸ‘‰
        </div>

        <ul id="trackList" class="list-unstyled d-flex flex-nowrap gap-2 justify-content-start"
            style="width: max-content;">
            {% for track in tracks %}
                <li data-id="{{ track.id }}" data-url="{{ track.audio_file.url }}"
                    class="d-flex align-items-center gap-2 p-2 rounded {% if track.id == current_track.id %} active bg-success bg-opacity-25{% endif %}"
                    style="cursor:pointer; white-space: normal;">
                    {% if track.cover %}
                        <img src="{{ track.cover.url }}" alt="ÐžÐ±Ð»Ð¾Ð¶ÐºÐ°" class="mini-cover rounded">
                    {% else %}
                        <img src="{% static 'botapp/static/img/no_images.png' %}" alt="ÐžÐ±Ð»Ð¾Ð¶ÐºÐ°"
                             class="mini-cover rounded">
                    {% endif %}
                    <span class="text-truncate" style="max-width: 150px;">{{ track.title }}</span>
                </li>
            {% endfor %}
        </ul>
    </div>
{% endblock %}